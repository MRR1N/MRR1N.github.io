const ageModal = document.getElementById('ageModal'),
      modalContent = document.getElementById('modalContent'),
      adultYesBtn = document.getElementById('adult-yes'),
      adultNoBtn = document.getElementById('adult-no');

function confirmAdult(isAdult) {
    if(isAdult){
        localStorage.setItem('adultConfirmed','true');
        ageModal.style.display='none';
    } else {
        document.querySelector('#modalContent img').src='sprite2.png';
        document.querySelector('#modalText').textContent='Refresh the page to try again';
        adultYesBtn.style.display='none';
        adultNoBtn.style.display='none';
    }
}

if(localStorage.getItem('adultConfirmed')==='true') ageModal.style.display='none';

adultYesBtn.addEventListener('click', ()=>confirmAdult(true));
adultNoBtn.addEventListener('click', ()=>confirmAdult(false));

function switchLang(l){
    const h = document.getElementById('header-desc'),
          p = document.getElementById('pricing-title'),
          r = document.getElementById('reviews-title'),
          n = document.querySelector('#review-write input'),
          t = document.querySelector('#review-write textarea'),
          b = document.querySelector('#review-write button'),
          tos = document.querySelector('.tos-toggle');

    if(l==='ru'){
        h.textContent='2D Ğ¤ÑƒÑ€Ñ€Ğ¸ Ñ…ÑƒĞ´Ğ¾Ğ¶Ğ½Ğ¸Ğº Ğ¸ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ‚Ğ¾Ñ€';
        p.textContent='ĞŸÑ€Ğ°Ğ¹Ñ-Ğ»Ğ¸ÑÑ‚';
        r.textContent='ĞÑ‚Ğ·Ñ‹Ğ²Ñ‹';
        n.placeholder='ĞĞ¸ĞºĞ½ĞµĞ¹Ğ¼';
        t.placeholder='Ğ’Ğ°Ñˆ Ğ¾Ñ‚Ğ·Ñ‹Ğ²';
        b.textContent='ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ';
        tos.textContent='Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ *Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ';
        document.getElementById('pricing-content-en').style.display='none';
        document.getElementById('pricing-content-ru').style.display='flex';
        document.getElementById('pricing-content-es').style.display='none';
    } else if(l==='es'){
        h.textContent='Artista y Animador Furry 2D';
        p.textContent='Precios';
        r.textContent='ReseÃ±as (haz clic para dejar la tuya)';
        n.placeholder='Apodo';
        t.placeholder='Tu reseÃ±a';
        b.textContent='Enviar reseÃ±a';
        tos.textContent='TÃ©rminos de Servicio (clic para expandir)';
        document.getElementById('pricing-content-en').style.display='none';
        document.getElementById('pricing-content-ru').style.display='none';
        document.getElementById('pricing-content-es').style.display='flex';
    } else {
        h.textContent='2D Furry Artist & Animator';
        p.textContent='Pricing';
        r.textContent='Reviews *click';
        n.placeholder='Nickname';
        t.placeholder='Your review';
        b.textContent='Submit';
        tos.textContent='TOS (Click to expand)';
        document.getElementById('pricing-content-en').style.display='flex';
        document.getElementById('pricing-content-ru').style.display='none';
        document.getElementById('pricing-content-es').style.display='none';
    }
}

document.getElementById('btn-en').addEventListener('click', ()=>switchLang('en'));
document.getElementById('btn-ru').addEventListener('click', ()=>switchLang('ru'));
document.getElementById('btn-es').addEventListener('click', ()=>switchLang('es'));

const reviewsList = document.getElementById('existing-reviews');

function loadReviews(){
    const r = JSON.parse(localStorage.getItem('reviews') || '[]');
    reviewsList.innerHTML = '';
    r.forEach((e,i)=>{
        const d = document.createElement('div');
        d.className = 'review-item';
        if(localStorage.getItem('admin') === 'true'){
            d.innerHTML = `<div class='review-avatar'>ğŸ¾</div><strong>${e.nickname}:</strong> <span>${e.text}</span> <button class='delete-btn' data-index='${i}'>âœ–</button>`;
        } else {
            d.innerHTML = `<div class='review-avatar'>ğŸ¾</div><strong>${e.nickname}:</strong> <span>${e.text}</span>`;
        }
        reviewsList.appendChild(d);
    });
}

function submitReview(event){
    event.preventDefault();
    const nickname = document.getElementById('nickname');
    const review = document.getElementById('review');

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ¸ĞºĞ½ĞµĞ¹Ğ¼Ğ°
    if(!nickname.value.trim()){
        nickname.setCustomValidity('Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»Ğµ');
        nickname.reportValidity();
        return;
    } else {
        nickname.setCustomValidity('');
    }

    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¾Ñ‚Ğ·Ñ‹Ğ²Ğ°
    if(!review.value.trim()){
        review.setCustomValidity('Ğ—Ğ°Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚Ğµ Ğ¿Ğ¾Ğ»Ğµ');
        review.reportValidity();
        return;
    } else {
        review.setCustomValidity('');
    }

    const r = JSON.parse(localStorage.getItem('reviews') || '[]');
    r.push({nickname: nickname.value.trim(), text: review.value.trim()});
    localStorage.setItem('reviews', JSON.stringify(r));
    loadReviews();
    nickname.value='';
    review.value='';
}

document.querySelector('.review-form').addEventListener('submit', submitReview);

reviewsList.addEventListener('click', e=>{
    if(e.target.classList.contains('delete-btn') && localStorage.getItem('admin') === 'true'){
        const i = e.target.dataset.index;
        const r = JSON.parse(localStorage.getItem('reviews') || '[]');
        r.splice(i,1);
        localStorage.setItem('reviews', JSON.stringify(r));
        loadReviews();
    }
});

function toggleReviewForm(){
    const r = document.getElementById('review-write');
    r.style.maxHeight = r.style.maxHeight && r.style.maxHeight !== '0px' ? '0' : r.scrollHeight + 'px';
}

loadReviews();

function toggleTOS(){
    const tosContent = document.getElementById('tos-content');
    tosContent.style.maxHeight = tosContent.style.maxHeight && tosContent.style.maxHeight !== '0px' ? '0' : tosContent.scrollHeight + 'px';
}

// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ²Ñ‹ÑĞ¾Ñ‚Ñ‹ Ñ„Ğ¾Ñ€Ğ¼ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
document.addEventListener('DOMContentLoaded', () => {
    const reviewWrite = document.getElementById('review-write');
    const tosContent = document.getElementById('tos-content');
    reviewWrite.style.maxHeight = '0';
    tosContent.style.maxHeight = '0';
});
